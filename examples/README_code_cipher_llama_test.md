# Инструкция по тестированию качества ответов Llama на обфусцированные промпты

Данный скрипт (`code_cipher_llama_test.py`) позволяет оценить, насколько эффективно обфускатор кода `CodeCipherObfuscator` скрывает исходный код от человека, сохраняя при этом возможность модели Llama (или других LLM) корректно анализировать и отвечать на вопросы о функциональности кода.

## Назначение

- Тестирование качества ответов модели на обфусцированный код
- Сравнение ответов на оригинальные и обфусцированные промпты
- Оценка эффективности обфускации с точки зрения сохранения функциональности

## Требования

1. Установленная библиотека `llama-cpp-python`:
   ```
   pip install llama-cpp-python
   ```
   
   Для ускорения на GPU:
   ```
   pip install llama-cpp-python --force-reinstall --extra-index-url https://jllllll.github.io/llama-cpp-python-cuBLAS-wheels/AVX2/cu121
   ```

2. Локальная модель Llama в формате GGUF (например, Llama 3, Mistral, Gemma и т.д.)

## Использование

```bash
# Тестирование всех примеров
python examples/code_cipher_llama_test.py --model /путь/к/модели.gguf

# Тестирование конкретного примера
python examples/code_cipher_llama_test.py --model /путь/к/модели.gguf --examples 1

# Подробный вывод (с полными промптами и ответами)
python examples/code_cipher_llama_test.py --model /путь/к/модели.gguf --verbose

# Сохранение результатов в JSON-файл
python examples/code_cipher_llama_test.py --model /путь/к/модели.gguf --save results.json
```

## Параметры

| Параметр      | Описание                                        | Обязательный | По умолчанию |
|---------------|------------------------------------------------|--------------|--------------|
| --model       | Путь к файлу модели в формате GGUF              | Да           | -            |
| --examples    | Номер конкретного примера для тестирования (1-3) | Нет          | все примеры  |
| --verbose     | Показывать полные промпты и ответы              | Нет          | False        |
| --max-tokens  | Максимальное количество токенов в ответе        | Нет          | 1000         |
| --temperature | Температура генерации (0.0-1.0)                 | Нет          | 0.7          |
| --save        | Путь для сохранения результатов в JSON-файл     | Нет          | -            |

## Примеры тестов

Скрипт включает три готовых примера, которые тестируют различные аспекты понимания обфусцированного кода:

1. **Сортировка пузырьком на Python** - проверяет понимание алгоритма и его сложности
2. **Функция поиска на JavaScript** - проверяет понимание функционала и возможные улучшения
3. **Класс стека на C++** - проверяет понимание ООП-концепций и шаблонов

## Интерпретация результатов

Для каждого теста скрипт выводит:

- **Сходство ответов**: процент сходства между ответами на оригинальный и обфусцированный код
- **Статистика длины**: разница в длине ответов в символах и процентах 
- **Ключевые фразы**: количество общих и уникальных фраз в ответах
- **Примеры уникальных фраз**: до 5 примеров уникальных фраз из каждого ответа
- **Вывод**: общий вердикт об эффективности обфускации

Ответы считаются **похожими**, если процент сходства превышает 80%. Высокое сходство указывает на то, что обфускация успешно скрывает код от человека, при этом сохраняя способность модели анализировать его функциональность.

## Добавление своих примеров

Для добавления своих примеров кода отредактируйте функцию `get_test_examples()` в файле скрипта. Каждый пример должен содержать следующие поля:

```python
{
    "name": "Название примера",
    "language": "язык_программирования",
    "code": """
    // Ваш код здесь
    """,
    "question": "Вопрос о коде для модели"
}
```

## Результаты в JSON

При использовании параметра `--save` результаты сохраняются в JSON-файл в следующем формате:

```json
[
  {
    "example": "Название примера",
    "original_response": "Текст ответа на оригинальный код",
    "obfuscated_response": "Текст ответа на обфусцированный код",
    "analysis": {
      "similarity_percentage": 85.5,
      "original_length": 1200,
      "obfuscated_length": 1150,
      "length_diff": 50,
      "length_diff_percentage": 4.17,
      "common_phrases_count": 120,
      "original_unique_count": 30,
      "obfuscated_unique_count": 25,
      "original_unique_samples": ["пример1", "пример2", ...],
      "obfuscated_unique_samples": ["пример1", "пример2", ...],
      "is_similar": true
    }
  },
  // Другие примеры...
]
``` 