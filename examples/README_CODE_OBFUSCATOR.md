# CodeObfuscator - Сканер для обфускации кода в промптах

## Описание

`CodeObfuscator` - это сканер, который обфусцирует код в промптах, сохраняя его читаемость для LLM-моделей, но затрудняя чтение для людей. Он использует различные техники обфускации:

1. **Замена ASCII-символов на гомоглифы** - символы, которые выглядят визуально идентично, но имеют разные Unicode-значения (например, латинская 'a' → кириллическая 'а')
2. **Вставка невидимых Unicode-символов** - добавление специальных невидимых символов между обычными символами
3. **Модификация идентификаторов** - замена букв в именах переменных и функций на визуально похожие цифры

При этом сохраняется структура кода и его понятность для LLM-моделей.

## Преимущества

- **Защита интеллектуальной собственности** - код остается функциональным, но затрудняется его копирование и анализ людьми
- **Поддержка деобфускации** - возможность восстановления оригинального кода с помощью Vault
- **Гибкие настройки** - различные параметры для настройки уровня обфускации
- **Сохранение структуры** - обфускированный код сохраняет структуру и функциональность

## Использование

### Базовое использование

```python
from llm_guard.input_scanners import CodeObfuscator

# Инициализация
obfuscator = CodeObfuscator(
    homoglyph_probability=0.5,         # Вероятность замены символов на гомоглифы
    invisible_char_probability=0.3,     # Вероятность добавления невидимых символов
    identifier_modification_probability=0.4,  # Вероятность модификации идентификаторов
    preserve_keywords=True             # Сохранять ключевые слова языка без изменений
)

# Обфускация промпта
obfuscated_prompt, is_valid, risk_score = obfuscator.scan(original_prompt)
```

### Использование с Vault для деобфускации

```python
from llm_guard.input_scanners import CodeObfuscator
from llm_guard.vault import Vault

# Создание хранилища
vault = Vault()

# Инициализация с поддержкой сохранения оригинального кода
obfuscator = CodeObfuscator(
    homoglyph_probability=0.5,
    invisible_char_probability=0.3,
    identifier_modification_probability=0.4,
    preserve_keywords=True,
    enable_vault=True,  # Включаем сохранение оригинального кода
    vault=vault         # Передаем объект хранилища
)

# Обфускация промпта
obfuscated_prompt, _, _ = obfuscator.scan(original_prompt)

# Деобфускация промпта
deobfuscated_prompt = obfuscator.deobfuscate(obfuscated_prompt)
```

## Параметры

### Инициализация

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `homoglyph_probability` | float | 0.5 | Вероятность замены символа на гомоглиф (0-1) |
| `invisible_char_probability` | float | 0.3 | Вероятность добавления невидимого символа (0-1) |
| `identifier_modification_probability` | float | 0.4 | Вероятность модификации идентификаторов (0-1) |
| `preserve_keywords` | bool | True | Сохранять ли ключевые слова языков программирования без изменений |
| `code_detector` | Code | None | Опциональный детектор кода, если None - будет использован встроенный Code |
| `enable_vault` | bool | False | Включить сохранение оригинального кода для деобфускации |
| `vault` | Vault | None | Объект Vault для хранения оригинального кода, если None - создается новый |

### Методы

| Метод | Параметры | Возвращаемое значение | Описание |
|-------|-----------|----------------------|----------|
| `scan(prompt)` | str | (str, bool, float) | Обфусцирует код в промпте. Возвращает обфусцированный промпт, всегда True (так как это не фильтр), и 0.0 (риск) |
| `deobfuscate(obfuscated_prompt)` | str | str | Деобфусцирует промпт, восстанавливая оригинальный код из Vault |
| `get_vault()` | - | Vault | Возвращает объект Vault с сохраненными парами |

## Пример

См. полный пример в файле [code_obfuscation_example.py](code_obfuscation_example.py). 