# Улучшенный обфускатор кода (EnhancedCodeCipherObfuscator)

Система улучшенной обфускации кода, объединяющая возможности ANTLR для разбора кода и CodeCipher для создания конфузионных отображений.

## Обзор

EnhancedCodeCipherObfuscator — это инструмент для обфускации кода, который:

1. Использует ANTLR для глубокого анализа и извлечения токенов из исходного кода
2. Применяет алгоритмы машинного обучения для создания конфузионных отображений
3. Обеспечивает сохранение семантики кода после обфускации
4. Затрудняет извлечение конфиденциальной информации из кода при сохранении его функциональности

Система поддерживает следующие языки программирования:
- Python
- JavaScript
- Java
- C#
- Kotlin
- PHP
- Ruby
- Swift
- Go
- Rust

## Установка

Убедитесь, что у вас установлены все необходимые зависимости:

```bash
pip install transformers torch numpy nltk openai
```

Также для работы с ANTLR требуется установить соответствующий пакет:

```bash
pip install antlr4-python3-runtime
```

## Использование

### Базовое использование

```python
from llm_guard.input_scanners.enhanced_code_cipher import EnhancedCodeCipherObfuscator

# Инициализация обфускатора
obfuscator = EnhancedCodeCipherObfuscator(
    model_name="distilbert-base-uncased",  # Модель для эмбеддингов
    use_antlr=True,                        # Использовать ANTLR для анализа кода
    embedding_dim=768,                     # Размерность эмбеддингов
    similarity_threshold=0.7               # Порог похожести токенов
)

# Примерный код для обфускации
code = """
def check_password(username, password):
    if username == "admin" and password == "secret123":
        return True
    return False
"""

# Обфускация без обучения
obfuscated_code = obfuscator._obfuscate_code(code)
print(obfuscated_code)
```

### Обфускация с обучением конфузионной матрицы

```python
# Тренировка конфузионного отображения
obfuscator.train_confusion_mapping([code])

# Обфускация с использованием конфузионной матрицы
obfuscated_code = obfuscator.obfuscate_with_confusion(code)
print(obfuscated_code)
```

### Использование через командную строку

Для удобства работы с обфускатором можно использовать интерфейс командной строки:

```bash
python examples/use_enhanced_obfuscator.py --use-antlr --use-confusion --code-file path/to/code.py
```

## Тестирование понимания LLM

Для оценки эффективности обфускации с точки зрения защиты от LLM можно использовать специальный тестовый скрипт:

```bash
python examples/llm_understanding_test.py --use-antlr --use-confusion --api-key your_openai_api_key --output results.json
```

Этот скрипт:
1. Обфусцирует тестовый код (или код из указанного файла)
2. Отправит запросы к LLM (например, GPT-3.5) с оригинальным и обфусцированным кодом
3. Проанализирует, насколько хорошо LLM может извлечь конфиденциальную информацию из обфусцированного кода
4. Создаст отчет о приватности

## Детали реализации

### Алгоритмы обфускации

1. **ANTLR-обфускация**: использует парсеры ANTLR для извлечения идентификаторов, литералов и импортов из кода, что позволяет лучше понимать структуру кода и его семантические элементы.

2. **Конфузионное отображение**: обучается на наборе кодов для создания отображений между токенами, максимизирующих семантическую близость, но минимизирующих текстуальное сходство.

3. **Дискретный градиентный поиск**: оптимизирует отображения между токенами для достижения максимальной эффективности обфускации.

### Метрики

Эффективность обфускации оценивается по нескольким метрикам:

1. **Оценка приватности**: измеряет, насколько хорошо защищены конфиденциальные данные
2. **Семантическая сохранность**: оценивает, насколько хорошо сохраняется семантика кода
3. **Устойчивость к LLM**: определяет, насколько сложно LLM извлечь конфиденциальную информацию из обфусцированного кода

## Ограничения

- Обфускация не является шифрованием и не может гарантировать 100% защиту от извлечения данных
- Для некоторых языков программирования анализ с помощью ANTLR может быть неполным
- Обфускированный код может потерять читаемость и стать сложнее для поддержки

## Примеры

В директории `examples/` вы найдете несколько примеров использования обфускатора:

1. `use_enhanced_obfuscator.py` - базовый пример использования
2. `llm_understanding_test.py` - тестирование понимания LLM

## Лицензия

Данный проект распространяется под лицензией MIT. 